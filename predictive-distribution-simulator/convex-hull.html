<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charlotte | The Convex Hull</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #232324;
  --surface: #2D2B2E;
  --surface-variant: #3D3B3E;
  --primary: #7200CB;
  --primary-light: #AA66E0;
  --secondary: #F000D2;
  --tertiary: #21D6C6;
  --error: #CE4F51;
  --warning: #FFD93D;
  --text-primary: #F2F2F3;
  --text-secondary: #ECECEC;
  --text-tertiary: #5B575E;
  --glass-fill: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.12);
}
html, body { height: 100%; background: var(--bg); color: var(--text-primary); font-family: 'Inter', sans-serif; overflow: hidden; }
h1, h2, h3, h4, .label { font-family: 'Oswald', sans-serif; }

#app { height: 100vh; display: flex; flex-direction: column; }

.top-bar {
  display: flex; align-items: center; padding: 16px 28px;
  background: rgba(45,43,46,0.80); backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border); gap: 14px; flex-shrink: 0;
}
.brand-logo {
  width: 36px; height: 36px; border-radius: 10px;
  background: linear-gradient(135deg, var(--secondary), var(--primary), var(--tertiary));
  display: flex; align-items: center; justify-content: center;
  font-family: 'Oswald'; font-weight: 600; font-size: 18px; color: white;
}
.top-bar h1 { font-size: 20px; font-weight: 500; letter-spacing: 1px; }
.top-bar h1 span { color: var(--text-tertiary); font-weight: 400; font-size: 14px; margin-left: 8px; }

.main { flex: 1; display: flex; position: relative; overflow: hidden; }

/* === CANVAS === */
canvas#hull { position: absolute; inset: 0; width: 100%; height: 100%; }

/* === DOMAIN DETAIL PANEL === */
.detail-panel {
  position: absolute; right: 24px; top: 24px; width: 340px;
  background: rgba(45,43,46,0.85); backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border); border-radius: 16px;
  padding: 24px; opacity: 0; transform: translateX(20px);
  transition: all 0.4s ease; pointer-events: none; z-index: 10;
}
.detail-panel.visible { opacity: 1; transform: translateX(0); pointer-events: auto; }
.detail-panel h2 { font-size: 22px; margin-bottom: 4px; }
.detail-panel .domain-sub { font-size: 13px; color: var(--text-tertiary); margin-bottom: 16px; font-family: 'Oswald'; letter-spacing: 0.5px; }
.detail-panel .insight { font-size: 13px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 18px; font-style: italic; border-left: 2px solid var(--primary-light); padding-left: 12px; }
.mapping-title { font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Oswald'; margin-bottom: 10px; }
.mapping-list { display: flex; flex-direction: column; gap: 8px; }
.mapping-row {
  display: flex; align-items: center; gap: 10px; padding: 8px 12px;
  background: var(--glass-fill); border: 1px solid var(--glass-border); border-radius: 8px; font-size: 12px;
}
.mapping-row .primitive {
  font-family: 'Oswald'; font-size: 11px; letter-spacing: 1px; text-transform: uppercase;
  padding: 3px 8px; border-radius: 4px; min-width: 70px; text-align: center; font-weight: 500;
}
.mapping-row .arrow { color: var(--text-tertiary); }
.mapping-row .example { color: var(--text-secondary); flex: 1; }
.p-node { background: rgba(114,0,203,0.25); color: var(--primary-light); }
.p-metric { background: rgba(33,214,198,0.2); color: var(--tertiary); }
.p-signal { background: rgba(240,0,210,0.2); color: var(--secondary); }
.p-edge { background: rgba(255,217,61,0.2); color: var(--warning); }
.p-protocol { background: rgba(33,150,243,0.2); color: #64B5F6; }

.close-btn {
  position: absolute; top: 12px; right: 14px; background: none; border: none;
  color: var(--text-tertiary); font-size: 20px; cursor: pointer; line-height: 1;
}
.close-btn:hover { color: var(--text-primary); }

/* === BOTTOM QUOTE === */
.bottom-bar {
  position: absolute; bottom: 0; left: 0; right: 0; text-align: center;
  padding: 16px 24px; background: linear-gradient(transparent, rgba(35,35,36,0.9));
  pointer-events: none;
}
.bottom-bar p {
  font-family: 'Oswald'; font-size: 15px; color: var(--text-tertiary);
  letter-spacing: 1px; font-weight: 400;
}
.bottom-bar p em { color: var(--text-secondary); font-style: normal; }

/* === HINT === */
.hint {
  position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%);
  font-size: 12px; color: var(--text-tertiary); font-family: 'Oswald';
  letter-spacing: 1px; pointer-events: none; opacity: 0.7;
}
</style>
</head>
<body>
<div id="app">
  <header class="top-bar">
    <div class="brand-logo">C</div>
    <h1>CHARLOTTE <span>The Convex Hull</span></h1>
  </header>
  <div class="main">
    <canvas id="hull"></canvas>
    <div class="detail-panel" id="detailPanel">
      <button class="close-btn" onclick="closeDetail()">&times;</button>
      <h2 id="detailTitle"></h2>
      <div class="domain-sub" id="detailSub"></div>
      <div class="insight" id="detailInsight"></div>
      <div class="mapping-title">Primitive Mapping</div>
      <div class="mapping-list" id="detailMappings"></div>
    </div>
    <div class="hint" id="hint">CLICK A DOMAIN TO EXPLORE</div>
    <div class="bottom-bar">
      <p>"If these four extremes share the same structure, that structure is <em>universal</em>."</p>
    </div>
  </div>
</div>

<script>
// ============================================================
// DOMAIN DATA
// ============================================================
const domains = [
  {
    id: 'lineleap',
    name: 'LineLeap',
    sub: 'Human Behavior â€” 4-Year College Lifecycles',
    color: '#2196F3',
    icon: 'ðŸ‘¤',
    lifecycle: '4 years',
    insight: 'Individual events are noise. Trajectories are signal. Prediction quality increases as observation windows lengthen.',
    mappings: [
      { primitive: 'NODE', cls: 'p-node', example: 'Student, Venue, Bartender' },
      { primitive: 'METRIC', cls: 'p-metric', example: 'Spend, Frequency, Drink preference' },
      { primitive: 'SIGNAL', cls: 'p-signal', example: 'Check-in, Purchase, Rating' },
      { primitive: 'EDGE', cls: 'p-edge', example: 'VISITS, FRIENDS_WITH, PREFERS' },
      { primitive: 'PROTOCOL', cls: 'p-protocol', example: 'Happy hour schedule, Promo cadence' },
    ]
  },
  {
    id: 'sounder',
    name: 'Sounder',
    sub: 'Biological Systems â€” Breeding Cycle Lifecycles',
    color: '#4CAF50',
    icon: 'ðŸ–',
    lifecycle: 'Months',
    insight: 'Outcomes cannot be optimized directly â€” only trajectories can be shaped. Champion pigs emerge from coherent signal alignment over time.',
    mappings: [
      { primitive: 'NODE', cls: 'p-node', example: 'Sow, Sire, Litter, Operation' },
      { primitive: 'METRIC', cls: 'p-metric', example: 'Weight, Litter size, Back fat' },
      { primitive: 'SIGNAL', cls: 'p-signal', example: 'Breeding event, Farrowing, Weigh-in' },
      { primitive: 'EDGE', cls: 'p-edge', example: 'PARENT_OF, SIRED_BY, MEMBER_OF' },
      { primitive: 'PROTOCOL', cls: 'p-protocol', example: 'Matrix sync, Gestation schedule' },
    ]
  },
  {
    id: 'isg',
    name: 'ISG',
    sub: 'Mechanical Systems â€” Multi-Year Equipment Lifecycles',
    color: '#FF9800',
    icon: 'âš™',
    lifecycle: 'Years',
    insight: 'Prediction is not about forecasting failure dates â€” it is about detecting deviation from expected trajectories early enough to act.',
    mappings: [
      { primitive: 'NODE', cls: 'p-node', example: 'Compressor, Valve, Pump, Facility' },
      { primitive: 'METRIC', cls: 'p-metric', example: 'Vibration, Temperature, Pressure' },
      { primitive: 'SIGNAL', cls: 'p-signal', example: 'Service event, Reading, Part swap' },
      { primitive: 'EDGE', cls: 'p-edge', example: 'INSTALLED_AT, SERVICED_BY, SUPPLIES' },
      { primitive: 'PROTOCOL', cls: 'p-protocol', example: 'Maintenance schedule, Reorder cycle' },
    ]
  },
  {
    id: 'prier',
    name: 'Prier Violins',
    sub: 'Cultural Artifacts â€” Century-Spanning Lifecycles',
    color: '#E91E63',
    icon: 'ðŸŽ»',
    lifecycle: 'Centuries',
    insight: 'Value is the integrity of the story. Each violin is a node whose identity outlives its handlers. Signals are sparse but decisive.',
    mappings: [
      { primitive: 'NODE', cls: 'p-node', example: 'Violin, Maker, Owner, Restorer' },
      { primitive: 'METRIC', cls: 'p-metric', example: 'Condition, Appraisal, Authenticity' },
      { primitive: 'SIGNAL', cls: 'p-signal', example: 'Ownership transfer, Restoration, Cert' },
      { primitive: 'EDGE', cls: 'p-edge', example: 'CREATED_BY, OWNED_BY, RESTORED_BY' },
      { primitive: 'PROTOCOL', cls: 'p-protocol', example: 'Revaluation schedule, Storage reqs' },
    ]
  }
];

const primitives = [
  { name: 'NODE', color: '#AA66E0', desc: 'Identity with a lifecycle' },
  { name: 'METRIC', color: '#21D6C6', desc: 'Measurable dimension' },
  { name: 'SIGNAL', color: '#F000D2', desc: 'Time-indexed fact' },
  { name: 'EDGE', color: '#FFD93D', desc: 'First-class relationship' },
  { name: 'PROTOCOL', color: '#64B5F6', desc: 'Expectation generator' },
];

// ============================================================
// CANVAS SETUP
// ============================================================
const canvas = document.getElementById('hull');
const ctx = canvas.getContext('2d');
let W, H, cx, cy, dpr;
let hoverDomain = null;
let selectedDomain = null;
let animT = 0;
let domainPositions = [];
let centerRadius = 0;

function resize() {
  dpr = window.devicePixelRatio || 1;
  W = canvas.parentElement.clientWidth;
  H = canvas.parentElement.clientHeight;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  cx = W / 2 - 40;
  cy = H / 2;
  centerRadius = Math.min(W, H) * 0.09;
  computePositions();
}

function computePositions() {
  const orbitRadius = Math.min(W, H) * 0.32;
  const angles = [-Math.PI/2, Math.PI/2, Math.PI, 0]; // top, bottom, left, right
  domainPositions = domains.map((d, i) => ({
    x: cx + Math.cos(angles[i]) * orbitRadius,
    y: cy + Math.sin(angles[i]) * orbitRadius,
    radius: Math.min(W, H) * 0.065,
    domain: d,
    angle: angles[i]
  }));
}

// ============================================================
// DRAWING
// ============================================================
function draw() {
  animT += 0.008;
  ctx.clearRect(0, 0, W, H);

  // Subtle grid
  drawGrid();

  // Connection lines from domains to center
  domainPositions.forEach((dp, i) => {
    const isActive = selectedDomain === dp.domain.id || hoverDomain === dp.domain.id;
    drawConnection(dp, isActive);
  });

  // Center cluster â€” Charlotte primitives
  drawCenter();

  // Domain nodes
  domainPositions.forEach((dp) => {
    const isActive = selectedDomain === dp.domain.id || hoverDomain === dp.domain.id;
    drawDomainNode(dp, isActive);
  });

  // Lifecycle labels on connections
  domainPositions.forEach((dp) => {
    drawLifecycleLabel(dp);
  });

  requestAnimationFrame(draw);
}

function drawGrid() {
  ctx.strokeStyle = 'rgba(255,255,255,0.02)';
  ctx.lineWidth = 1;
  for (let i = 0; i < W; i += 60) {
    ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, H); ctx.stroke();
  }
  for (let i = 0; i < H; i += 60) {
    ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(W, i); ctx.stroke();
  }
}

function drawConnection(dp, isActive) {
  const alpha = isActive ? 0.4 : 0.12;
  const lineWidth = isActive ? 2.5 : 1.5;

  // Animated particles along the line
  ctx.strokeStyle = hexToRGBA(dp.domain.color, alpha);
  ctx.lineWidth = lineWidth;
  ctx.setLineDash([]);
  ctx.beginPath();
  ctx.moveTo(dp.x, dp.y);
  ctx.lineTo(cx, cy);
  ctx.stroke();

  // Flowing particles
  const particleCount = isActive ? 4 : 2;
  for (let p = 0; p < particleCount; p++) {
    const t = ((animT * 0.5 + p / particleCount) % 1);
    const px = dp.x + (cx - dp.x) * t;
    const py = dp.y + (cy - dp.y) * t;
    const pAlpha = isActive ? 0.7 : 0.3;
    const pSize = isActive ? 3 : 2;

    ctx.beginPath();
    ctx.arc(px, py, pSize, 0, Math.PI * 2);
    ctx.fillStyle = hexToRGBA(dp.domain.color, pAlpha * Math.sin(t * Math.PI));
    ctx.fill();
  }
}

function drawCenter() {
  // Outer glow
  const gradient = ctx.createRadialGradient(cx, cy, centerRadius * 0.5, cx, cy, centerRadius * 2);
  gradient.addColorStop(0, 'rgba(114,0,203,0.08)');
  gradient.addColorStop(1, 'rgba(114,0,203,0)');
  ctx.fillStyle = gradient;
  ctx.beginPath();
  ctx.arc(cx, cy, centerRadius * 2, 0, Math.PI * 2);
  ctx.fill();

  // Glass circle
  ctx.beginPath();
  ctx.arc(cx, cy, centerRadius, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(45,43,46,0.7)';
  ctx.fill();
  ctx.strokeStyle = 'rgba(255,255,255,0.15)';
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // Rotating ring
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(animT * 0.3);
  ctx.beginPath();
  ctx.arc(0, 0, centerRadius + 8, 0, Math.PI * 0.5);
  ctx.strokeStyle = 'rgba(114,0,203,0.3)';
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(0, 0, centerRadius + 8, Math.PI, Math.PI * 1.5);
  ctx.strokeStyle = 'rgba(33,214,198,0.3)';
  ctx.stroke();
  ctx.restore();

  // "CHARLOTTE" text
  ctx.font = '600 14px Oswald';
  ctx.fillStyle = var_text_primary();
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('CHARLOTTE', cx, cy - 8);

  ctx.font = '400 10px Oswald';
  ctx.fillStyle = 'rgba(242,242,243,0.4)';
  ctx.fillText('5 PRIMITIVES', cx, cy + 8);

  // Primitive dots orbiting
  primitives.forEach((p, i) => {
    const angle = (i / primitives.length) * Math.PI * 2 + animT * 0.2;
    const orbitR = centerRadius + 24;
    const px = cx + Math.cos(angle) * orbitR;
    const py = cy + Math.sin(angle) * orbitR;

    ctx.beginPath();
    ctx.arc(px, py, 14, 0, Math.PI * 2);
    ctx.fillStyle = hexToRGBA(p.color, 0.15);
    ctx.fill();
    ctx.strokeStyle = hexToRGBA(p.color, 0.4);
    ctx.lineWidth = 1;
    ctx.stroke();

    ctx.font = '500 7px Oswald';
    ctx.fillStyle = p.color;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(p.name, px, py);
  });
}

function drawDomainNode(dp, isActive) {
  const r = dp.radius;
  const pulseR = isActive ? r + 4 * Math.sin(animT * 3) : r;

  // Outer glow
  if (isActive) {
    const glow = ctx.createRadialGradient(dp.x, dp.y, r * 0.5, dp.x, dp.y, r * 2.5);
    glow.addColorStop(0, hexToRGBA(dp.domain.color, 0.15));
    glow.addColorStop(1, hexToRGBA(dp.domain.color, 0));
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(dp.x, dp.y, r * 2.5, 0, Math.PI * 2);
    ctx.fill();
  }

  // Glass circle
  ctx.beginPath();
  ctx.arc(dp.x, dp.y, pulseR, 0, Math.PI * 2);
  ctx.fillStyle = isActive ? hexToRGBA(dp.domain.color, 0.12) : 'rgba(45,43,46,0.6)';
  ctx.fill();
  ctx.strokeStyle = isActive ? hexToRGBA(dp.domain.color, 0.6) : 'rgba(255,255,255,0.12)';
  ctx.lineWidth = isActive ? 2 : 1.5;
  ctx.stroke();

  // Icon
  ctx.font = `${r * 0.55}px sans-serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(dp.domain.icon, dp.x, dp.y - 4);

  // Name below
  ctx.font = `600 ${Math.max(12, r * 0.28)}px Oswald`;
  ctx.fillStyle = isActive ? dp.domain.color : var_text_primary();
  ctx.fillText(dp.domain.name.toUpperCase(), dp.x, dp.y + r + 18);

  // Lifecycle tag
  ctx.font = `400 ${Math.max(10, r * 0.2)}px Oswald`;
  ctx.fillStyle = 'rgba(242,242,243,0.35)';
  ctx.fillText(dp.domain.lifecycle, dp.x, dp.y + r + 34);
}

function drawLifecycleLabel(dp) {
  const midX = dp.x + (cx - dp.x) * 0.5;
  const midY = dp.y + (cy - dp.y) * 0.5;
  // Already shown on the node itself
}

// ============================================================
// INTERACTION
// ============================================================
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  hoverDomain = null;
  canvas.style.cursor = 'default';

  domainPositions.forEach(dp => {
    const dist = Math.hypot(mx - dp.x, my - dp.y);
    if (dist < dp.radius + 10) {
      hoverDomain = dp.domain.id;
      canvas.style.cursor = 'pointer';
    }
  });
});

canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  let clicked = null;
  domainPositions.forEach(dp => {
    const dist = Math.hypot(mx - dp.x, my - dp.y);
    if (dist < dp.radius + 10) clicked = dp.domain;
  });

  if (clicked) {
    selectedDomain = clicked.id;
    showDetail(clicked);
  } else {
    closeDetail();
  }
});

function showDetail(domain) {
  document.getElementById('hint').style.opacity = '0';
  const panel = document.getElementById('detailPanel');
  document.getElementById('detailTitle').textContent = domain.name;
  document.getElementById('detailTitle').style.color = domain.color;
  document.getElementById('detailSub').textContent = domain.sub;
  document.getElementById('detailInsight').textContent = domain.insight;

  const list = document.getElementById('detailMappings');
  list.innerHTML = '';
  domain.mappings.forEach(m => {
    const row = document.createElement('div');
    row.className = 'mapping-row';
    row.innerHTML = `
      <span class="primitive ${m.cls}">${m.primitive}</span>
      <span class="arrow">â†’</span>
      <span class="example">${m.example}</span>
    `;
    list.appendChild(row);
  });

  panel.classList.add('visible');
}

function closeDetail() {
  selectedDomain = null;
  document.getElementById('detailPanel').classList.remove('visible');
}

// ============================================================
// HELPERS
// ============================================================
function hexToRGBA(hex, alpha) {
  const r = parseInt(hex.slice(1,3), 16);
  const g = parseInt(hex.slice(3,5), 16);
  const b = parseInt(hex.slice(5,7), 16);
  return `rgba(${r},${g},${b},${alpha})`;
}

function var_text_primary() { return '#F2F2F3'; }

// ============================================================
// INIT
// ============================================================
window.addEventListener('resize', resize);
resize();
draw();
</script>
</body>
</html>
