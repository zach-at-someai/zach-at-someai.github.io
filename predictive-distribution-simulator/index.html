<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charlotte | Predictive Distribution Simulator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Oswald:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #232324;
  --surface: #2D2B2E;
  --surface-variant: #3D3B3E;
  --primary: #7200CB;
  --primary-light: #AA66E0;
  --secondary: #F000D2;
  --tertiary: #21D6C6;
  --error: #CE4F51;
  --warning: #FFD93D;
  --text-primary: #F2F2F3;
  --text-secondary: #ECECEC;
  --text-tertiary: #5B575E;
  --glass-fill: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.12);
  --glass-fill-hover: rgba(255,255,255,0.10);
}

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text-primary);
  font-family: 'Inter', system-ui, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  overflow: hidden;
}

h1, h2, h3, h4, h5, h6, .label { font-family: 'Oswald', sans-serif; }

/* === LAYOUT === */
#app {
  display: grid;
  grid-template-rows: auto auto auto 1fr;
  height: 100vh;
  gap: 0;
}

/* === TOP BAR === */
.top-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 28px;
  background: rgba(45,43,46,0.80);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
}

.brand {
  display: flex;
  align-items: center;
  gap: 14px;
}

.brand-logo {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--secondary), var(--primary), var(--tertiary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Oswald', sans-serif;
  font-weight: 600;
  font-size: 18px;
  color: white;
}

.brand h1 {
  font-size: 20px;
  font-weight: 500;
  letter-spacing: 1px;
  color: var(--text-primary);
}

.brand h1 span {
  color: var(--text-tertiary);
  font-weight: 400;
  font-size: 14px;
  margin-left: 8px;
  letter-spacing: 0.5px;
}

/* === PHASE BAR === */
.phase-bar {
  display: flex;
  align-items: center;
  gap: 0;
  padding: 0 28px;
  background: rgba(45,43,46,0.50);
  border-bottom: 1px solid var(--glass-border);
  height: 40px;
}

.phase-step {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 18px;
  font-family: 'Oswald', sans-serif;
  font-size: 12px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-tertiary);
  position: relative;
  transition: all 0.4s ease;
}

.phase-step .phase-num {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  border: 1.5px solid var(--text-tertiary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  transition: all 0.4s ease;
}

.phase-step.active { color: var(--tertiary); }
.phase-step.active .phase-num {
  border-color: var(--tertiary);
  background: rgba(33,214,198,0.15);
  color: var(--tertiary);
}

.phase-step.completed { color: var(--text-secondary); }
.phase-step.completed .phase-num {
  border-color: var(--tertiary);
  background: var(--tertiary);
  color: var(--bg);
}

.phase-connector {
  flex: 1;
  height: 1px;
  background: var(--surface-variant);
  margin: 0 4px;
  position: relative;
}

.phase-connector .fill {
  height: 100%;
  background: var(--tertiary);
  width: 0%;
  transition: width 0.6s ease;
}

/* === TIME CONTROLS === */
.time-controls {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 10px 20px;
  background: rgba(45,43,46,0.40);
  border-bottom: 1px solid var(--glass-border);
}

.btn {
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  color: var(--text-primary);
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Oswald', sans-serif;
  font-size: 13px;
  letter-spacing: 0.5px;
  transition: all 0.2s ease;
}

.btn:hover { background: var(--glass-fill-hover); border-color: rgba(255,255,255,0.2); }
.btn.active { background: rgba(114,0,203,0.3); border-color: var(--primary-light); color: white; }

.play-btn {
  width: 38px;
  height: 38px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  font-size: 16px;
}

.play-btn.playing { background: rgba(206,79,81,0.3); border-color: var(--error); }

.time-display {
  font-family: 'Oswald', sans-serif;
  font-size: 15px;
  color: var(--text-secondary);
  min-width: 180px;
}

.time-display strong { color: var(--tertiary); font-size: 17px; }

.progress-track {
  flex: 1;
  height: 6px;
  background: var(--surface-variant);
  border-radius: 3px;
  overflow: hidden;
  cursor: pointer;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--tertiary));
  border-radius: 3px;
  transition: width 0.3s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  right: -5px;
  top: -4px;
  width: 14px;
  height: 14px;
  background: var(--tertiary);
  border-radius: 50%;
  border: 2px solid var(--bg);
  box-shadow: 0 0 10px rgba(33,214,198,0.5);
}

.month-markers {
  display: flex;
  justify-content: space-between;
  padding: 0 4px;
  margin-top: 2px;
}

.month-markers span {
  font-size: 9px;
  color: var(--text-tertiary);
  font-family: 'Oswald', sans-serif;
}

.speed-btns { display: flex; gap: 4px; }

.speed-btn {
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  color: var(--text-tertiary);
  width: 32px;
  height: 28px;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Oswald', sans-serif;
  font-size: 11px;
  transition: all 0.2s ease;
}

.speed-btn:hover { color: var(--text-primary); }
.speed-btn.active { background: rgba(114,0,203,0.3); border-color: var(--primary-light); color: var(--text-primary); }

/* === MAIN CONTENT === */
.main-content {
  display: grid;
  grid-template-columns: 1fr 340px;
  gap: 0;
  overflow: hidden;
}

/* === PROTOCOL GRID === */
.protocol-panel {
  padding: 16px 20px;
  overflow-y: auto;
}

.protocol-panel h2 {
  font-size: 13px;
  color: var(--text-tertiary);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 14px;
}

.protocol-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* === PROTOCOL CARD === */
.protocol-card {
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  padding: 16px 18px;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  transition: all 0.5s ease;
  position: relative;
  overflow: hidden;
}

.protocol-card::before {
  content: '';
  position: absolute;
  inset: -1px;
  border-radius: 14px;
  padding: 1px;
  background: transparent;
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  transition: background 0.5s ease;
  pointer-events: none;
}

.protocol-card.pending { opacity: 0.5; }

.protocol-card.building {
  border-color: rgba(255,217,61,0.35);
  opacity: 1;
}
.protocol-card.building::before { background: linear-gradient(135deg, rgba(255,217,61,0.2), transparent); }

.protocol-card.active {
  border-color: rgba(33,214,198,0.4);
  box-shadow: 0 0 25px rgba(33,214,198,0.08);
  opacity: 1;
}
.protocol-card.active::before { background: linear-gradient(135deg, rgba(33,214,198,0.25), transparent); }

.protocol-card.optimizing {
  border-color: rgba(114,0,203,0.4);
  box-shadow: 0 0 25px rgba(114,0,203,0.1);
  opacity: 1;
}
.protocol-card.optimizing::before { background: linear-gradient(135deg, rgba(114,0,203,0.25), transparent); }

.card-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 8px;
}

.card-top h3 {
  font-size: 15px;
  font-weight: 500;
  letter-spacing: 0.5px;
  line-height: 1.3;
}

.card-desc {
  font-size: 11.5px;
  color: var(--text-tertiary);
  margin-bottom: 14px;
  line-height: 1.4;
}

.proto-badge {
  font-family: 'Oswald', sans-serif;
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 3px 9px;
  border-radius: 20px;
  white-space: nowrap;
  flex-shrink: 0;
}

.proto-badge.pending { background: rgba(91,87,94,0.3); color: var(--text-tertiary); border: 1px solid rgba(91,87,94,0.4); }
.proto-badge.building { background: rgba(255,217,61,0.15); color: var(--warning); border: 1px solid rgba(255,217,61,0.3); }
.proto-badge.active { background: rgba(33,214,198,0.15); color: var(--tertiary); border: 1px solid rgba(33,214,198,0.3); }
.proto-badge.optimizing { background: rgba(114,0,203,0.2); color: var(--primary-light); border: 1px solid rgba(114,0,203,0.3); }

.card-metrics {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 6px;
  margin-bottom: 12px;
}

.card-metric {
  text-align: center;
}

.card-metric .cm-val {
  font-family: 'Oswald', sans-serif;
  font-size: 18px;
  font-weight: 500;
  color: var(--text-primary);
  line-height: 1.2;
}

.card-metric .cm-label {
  font-size: 9.5px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.3px;
  font-family: 'Oswald', sans-serif;
}

.protocol-card.pending .cm-val { color: var(--text-tertiary); }

.card-chart {
  width: 100%;
  height: 36px;
  border-radius: 4px;
  margin-bottom: 10px;
}

.card-revenue {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 10px;
  border-top: 1px solid var(--glass-border);
}

.card-revenue .cr-label {
  font-size: 10px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: 'Oswald', sans-serif;
}

.card-revenue .cr-val {
  font-family: 'Oswald', sans-serif;
  font-size: 20px;
  font-weight: 500;
}

.protocol-card.pending .cr-val { color: var(--text-tertiary); }
.protocol-card.building .cr-val { color: var(--warning); }
.protocol-card.active .cr-val { color: var(--tertiary); }
.protocol-card.optimizing .cr-val { color: var(--primary-light); }

.card-event {
  margin-top: 10px;
  padding: 8px 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 6px;
  font-size: 11px;
  color: var(--text-secondary);
  line-height: 1.4;
  min-height: 38px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.card-event .ce-icon { flex-shrink: 0; font-size: 12px; }

.protocol-card.pending .card-event {
  color: var(--text-tertiary);
  font-style: italic;
}

/* === RIGHT PANEL === */
.right-panel {
  display: flex;
  flex-direction: column;
  border-left: 1px solid var(--glass-border);
  overflow: hidden;
}

.metrics-panel {
  padding: 18px;
  border-bottom: 1px solid var(--glass-border);
}

.metrics-panel h2 {
  font-size: 13px;
  color: var(--text-tertiary);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 14px;
}

.metrics-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.metric-column {
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 12px;
}

.metric-column.charlotte {
  border-color: rgba(33,214,198,0.25);
  background: rgba(33,214,198,0.04);
}

.metric-column.without {
  border-color: rgba(206,79,81,0.2);
  background: rgba(206,79,81,0.03);
}

.metric-column h3 {
  font-size: 10px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--glass-border);
}

.metric-column.charlotte h3 { color: var(--tertiary); }
.metric-column.without h3 { color: var(--error); }

.metric-item { margin-bottom: 8px; }
.metric-item:last-child { margin-bottom: 0; }

.metric-item .metric-label {
  font-size: 9.5px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: 'Oswald', sans-serif;
}

.metric-item .metric-value {
  font-family: 'Oswald', sans-serif;
  font-size: 20px;
  font-weight: 500;
  line-height: 1.2;
}

.metric-column.charlotte .metric-value { color: var(--tertiary); }
.metric-column.without .metric-value { color: var(--error); }

.total-impact {
  margin-top: 12px;
  padding: 12px;
  background: rgba(114,0,203,0.08);
  border: 1px solid rgba(114,0,203,0.25);
  border-radius: 12px;
  text-align: center;
}

.total-impact .label {
  font-size: 10px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--primary-light);
  margin-bottom: 2px;
}

.total-impact .value {
  font-family: 'Oswald', sans-serif;
  font-size: 30px;
  font-weight: 600;
  background: linear-gradient(135deg, var(--secondary), var(--primary-light), var(--tertiary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.total-impact .subtitle {
  font-size: 11px;
  color: var(--text-tertiary);
  margin-top: 1px;
}

/* === EVENT LOG === */
.event-log {
  flex: 1;
  padding: 18px;
  overflow-y: auto;
  min-height: 0;
}

.event-log h2 {
  font-size: 13px;
  color: var(--text-tertiary);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 12px;
}

.event-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.event-item {
  display: flex;
  gap: 8px;
  padding: 8px 10px;
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  border-radius: 8px;
  animation: slidein 0.3s ease;
  font-size: 11.5px;
  line-height: 1.4;
}

.event-item .event-icon {
  font-size: 13px;
  flex-shrink: 0;
  margin-top: 1px;
}

.event-item .event-text { flex: 1; }

.event-item .event-time {
  font-family: 'Oswald', sans-serif;
  font-size: 10px;
  color: var(--text-tertiary);
  letter-spacing: 0.5px;
  flex-shrink: 0;
  margin-top: 1px;
}

.event-item.system { border-color: var(--glass-border); }
.event-item.pricing { border-color: rgba(33,214,198,0.25); }
.event-item.reactivation { border-color: rgba(240,0,210,0.25); }
.event-item.crossref { border-color: rgba(114,0,203,0.25); }
.event-item.lifecycle { border-color: rgba(255,217,61,0.25); }
.event-item.milestone { border-color: rgba(33,214,198,0.4); background: rgba(33,214,198,0.06); }

/* === INTRO OVERLAY === */
.intro-overlay {
  position: fixed;
  inset: 0;
  background: rgba(35,35,36,0.94);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: opacity 0.5s ease;
  overflow-y: auto;
}

.intro-overlay.hidden { opacity: 0; pointer-events: none; }

.intro-content {
  text-align: center;
  max-width: 640px;
  padding: 40px 40px 32px;
}

.intro-content .intro-logo {
  width: 72px;
  height: 72px;
  border-radius: 20px;
  background: linear-gradient(135deg, var(--secondary), var(--primary), var(--tertiary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Oswald', sans-serif;
  font-weight: 600;
  font-size: 32px;
  color: white;
  margin: 0 auto 24px;
  box-shadow: 0 0 60px rgba(114,0,203,0.3);
}

.intro-content h1 {
  font-size: 36px;
  font-weight: 500;
  letter-spacing: 2px;
  margin-bottom: 6px;
}

.intro-content .subtitle {
  font-size: 16px;
  color: var(--text-tertiary);
  margin-bottom: 24px;
  font-family: 'Oswald', sans-serif;
  letter-spacing: 1px;
}

.intro-content .intro-text {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.7;
  margin-bottom: 28px;
  text-align: left;
}

.intro-protocols {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 28px;
  text-align: left;
}

.intro-proto {
  padding: 12px 14px;
  background: var(--glass-fill);
  border: 1px solid var(--glass-border);
  border-radius: 10px;
}

.intro-proto .ip-num {
  font-family: 'Oswald', sans-serif;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  margin-bottom: 2px;
}

.intro-proto .ip-name {
  font-family: 'Oswald', sans-serif;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 3px;
}

.intro-proto .ip-desc {
  font-size: 12px;
  color: var(--text-tertiary);
  line-height: 1.4;
}

.intro-proto:nth-child(1) { border-color: rgba(33,214,198,0.3); }
.intro-proto:nth-child(2) { border-color: rgba(240,0,210,0.3); }
.intro-proto:nth-child(3) { border-color: rgba(114,0,203,0.3); }
.intro-proto:nth-child(4) { border-color: rgba(255,217,61,0.3); }

.intro-contract {
  font-size: 13px;
  color: var(--text-tertiary);
  margin-bottom: 24px;
  font-family: 'Oswald', sans-serif;
  letter-spacing: 0.5px;
}

.intro-contract strong { color: var(--primary-light); }

.start-btn {
  background: linear-gradient(135deg, var(--primary), rgba(114,0,203,0.8));
  border: 1px solid var(--primary-light);
  color: white;
  padding: 14px 40px;
  border-radius: 12px;
  cursor: pointer;
  font-family: 'Oswald', sans-serif;
  font-size: 18px;
  letter-spacing: 2px;
  transition: all 0.3s ease;
  box-shadow: 0 0 30px rgba(114,0,203,0.3);
}

.start-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 50px rgba(114,0,203,0.5);
}

@keyframes slidein {
  from { opacity: 0; transform: translateY(-6px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse-build {
  0%, 100% { box-shadow: 0 0 15px rgba(255,217,61,0.05); }
  50% { box-shadow: 0 0 25px rgba(255,217,61,0.15); }
}

.protocol-card.building { animation: pulse-build 2.5s ease-in-out infinite; }

/* === SCROLLBAR === */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--surface-variant); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

/* === RESPONSIVE === */
@media (max-width: 1100px) {
  .main-content { grid-template-columns: 1fr; }
  .right-panel { border-left: none; border-top: 1px solid var(--glass-border); max-height: 340px; }
  .protocol-grid { grid-template-columns: 1fr 1fr; }
}

@media (max-width: 720px) {
  .protocol-grid { grid-template-columns: 1fr; }
  .intro-protocols { grid-template-columns: 1fr; }
  .phase-step span:not(.phase-num) { display: none; }
}
</style>
</head>
<body>

<div id="app">
  <!-- TOP BAR -->
  <header class="top-bar">
    <div class="brand">
      <div class="brand-logo">C</div>
      <h1>CHARLOTTE <span>Predictive Distribution Simulator</span></h1>
    </div>
    <div>
      <button class="btn" onclick="resetSimulation()">RESET</button>
    </div>
  </header>

  <!-- PHASE BAR -->
  <div class="phase-bar">
    <div class="phase-step" id="phase-engage">
      <span class="phase-num">1</span>
      <span>Engage</span>
    </div>
    <div class="phase-connector"><div class="fill" id="pconn-1"></div></div>
    <div class="phase-step" id="phase-drive">
      <span class="phase-num">2</span>
      <span>Drive</span>
    </div>
    <div class="phase-connector"><div class="fill" id="pconn-2"></div></div>
    <div class="phase-step" id="phase-enable">
      <span class="phase-num">3</span>
      <span>Enable</span>
    </div>
    <div class="phase-connector"><div class="fill" id="pconn-3"></div></div>
    <div class="phase-step" id="phase-stabilize">
      <span class="phase-num">4</span>
      <span>Stabilize</span>
    </div>
  </div>

  <!-- TIME CONTROLS -->
  <div class="time-controls">
    <button class="btn play-btn" id="playBtn" onclick="togglePlay()">&#9654;</button>
    <div class="time-display" id="timeDisplay">
      Month <strong>0</strong> of 12 &mdash; <span class="phase-label">Ready</span>
    </div>
    <div style="flex:1">
      <div class="progress-track" id="progressTrack" onclick="seekTo(event)">
        <div class="progress-fill" id="progressFill" style="width:0%"></div>
      </div>
      <div class="month-markers">
        <span>MAR</span><span>APR</span><span>MAY</span><span>JUN</span><span>JUL</span><span>AUG</span>
        <span>SEP</span><span>OCT</span><span>NOV</span><span>DEC</span><span>JAN</span><span>FEB</span>
      </div>
    </div>
    <div class="speed-btns">
      <button class="speed-btn active" data-speed="1" onclick="setSpeed(1,this)">1x</button>
      <button class="speed-btn" data-speed="2" onclick="setSpeed(2,this)">2x</button>
      <button class="speed-btn" data-speed="4" onclick="setSpeed(4,this)">4x</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main-content">
    <!-- Protocol Grid -->
    <div class="protocol-panel">
      <h2>Charlotte Intelligence Protocols &mdash; ISG Compressor Vertical</h2>
      <div class="protocol-grid" id="protocolGrid"></div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
      <div class="metrics-panel">
        <h2>Financial Impact</h2>
        <div class="metrics-comparison">
          <div class="metric-column charlotte">
            <h3>With Charlotte</h3>
            <div class="metric-item">
              <div class="metric-label">Active Protocols</div>
              <div class="metric-value" id="m-protocols">0 / 4</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Revenue Generated</div>
              <div class="metric-value" id="m-rev">$0</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Customers Recovered</div>
              <div class="metric-value" id="m-recovered">0</div>
            </div>
          </div>
          <div class="metric-column without">
            <h3>Without Charlotte</h3>
            <div class="metric-item">
              <div class="metric-label">Revenue Leaking</div>
              <div class="metric-value" id="m-leak">$0</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Customers Churning</div>
              <div class="metric-value" id="m-churn">0</div>
            </div>
            <div class="metric-item">
              <div class="metric-label">Pricing Blind Spots</div>
              <div class="metric-value" id="m-blind">100+ SKUs</div>
            </div>
          </div>
        </div>
        <div class="total-impact">
          <div class="label">Net Charlotte Uplift</div>
          <div class="value" id="m-total">$0</div>
          <div class="subtitle" id="m-roi">Year 1 ROI on $480K investment</div>
        </div>
      </div>

      <div class="event-log">
        <h2>Activity Feed</h2>
        <div class="event-list" id="eventList"></div>
      </div>
    </div>
  </div>
</div>

<!-- INTRO OVERLAY -->
<div class="intro-overlay" id="introOverlay">
  <div class="intro-content">
    <div class="intro-logo">C</div>
    <h1>CHARLOTTE</h1>
    <div class="subtitle">Predictive Distribution Simulator</div>
    <div class="intro-text">
      ISG is a $3B+ industrial holding company managing 16 brands across compressed air, pumps, valves,
      and motors. Their compressor division serves <strong>62,000+ facilities</strong> across Texas, Indiana,
      Ohio, Florida, Tennessee, and Kentucky in a <strong>$12-15 billion</strong> US market.<br><br>
      This simulation recreates <strong>Year 1</strong> of Charlotte's deployment at ISG (March 2026 &ndash; February 2027).
      Watch four intelligence protocols activate over 12 months, generating revenue ISG cannot access
      without the intelligence layer.
    </div>
    <div class="intro-protocols">
      <div class="intro-proto">
        <div class="ip-num">Protocol 1 &mdash; Week 8</div>
        <div class="ip-name">Pricing Intelligence</div>
        <div class="ip-desc">Track competitor prices daily across CompressorWorld, CompressorNow, ACS, and Amazon. Optimize margins on top 100 SKUs.</div>
      </div>
      <div class="intro-proto">
        <div class="ip-num">Protocol 2 &mdash; Week 16</div>
        <div class="ip-name">Customer Reactivation</div>
        <div class="ip-desc">Detect dormant accounts at 60/90/180-day thresholds. Automated outreach campaigns with product affinity targeting.</div>
      </div>
      <div class="intro-proto">
        <div class="ip-num">Protocol 3 &mdash; Week 16</div>
        <div class="ip-name">Product Cross-Reference</div>
        <div class="ip-desc">Map OEM parts to aftermarket equivalents. Automate cross-sell recommendations when customers purchase equipment.</div>
      </div>
      <div class="intro-proto">
        <div class="ip-num">Protocol 4 &mdash; Week 24</div>
        <div class="ip-name">Equipment Lifecycle</div>
        <div class="ip-desc">Track installed base by age, hours, and repair costs. Fire replacement signals and convert to Total Care Bundles.</div>
      </div>
    </div>
    <div class="intro-contract">
      Year 1 Contract: <strong>$480,000</strong> &nbsp;|&nbsp; Expected ROI: <strong>18-26x</strong>
    </div>
    <button class="start-btn" onclick="startSimulation()">LAUNCH SIMULATION</button>
  </div>
</div>

<script>
// ============================================================
// CONFIGURATION
// ============================================================
const MONTHS = ['MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC','JAN','FEB'];
const TOTAL_MONTHS = 12;
const TICK_MS = 2500;

// Phases: month ranges (1-indexed)
const PHASES = [
  { id: 'engage',    label: 'Engage',    months: [1, 1] },
  { id: 'drive',     label: 'Drive',     months: [2, 4] },
  { id: 'enable',    label: 'Enable',    months: [5, 10] },
  { id: 'stabilize', label: 'Stabilize', months: [11, 12] }
];

// ============================================================
// PROTOCOL DEFINITIONS
// ============================================================
const PROTOCOLS = [
  {
    id: 'pricing',
    name: 'Pricing Intelligence',
    desc: 'Daily competitive price tracking across CompressorWorld, CompressorNow, ACS, and Amazon on the top 100 SKUs.',
    metricLabels: ['SKUs Tracked', 'Price Alerts', 'Margin +bps'],
    metricKeys: ['skus', 'alerts', 'bps'],
    color: 'rgba(33,214,198,',
    pendingEvent: 'Activates Week 8 — competitive pricing data delivery'
  },
  {
    id: 'reactivation',
    name: 'Customer Reactivation',
    desc: 'Five-tier dormancy engine (Active, AtRisk, Dormant, Lapsed, Lost) with automated outreach and product affinity targeting.',
    metricLabels: ['Dormant Found', 'Campaigns', 'Recovered'],
    metricKeys: ['dormant', 'campaigns', 'recovered'],
    color: 'rgba(240,0,210,',
    pendingEvent: 'Activates Week 16 — dormancy detection begins'
  },
  {
    id: 'crossref',
    name: 'Product Cross-Reference',
    desc: 'OEM-to-aftermarket part mappings, cross-brand equipment equivalents, and automated cross-sell recommendations.',
    metricLabels: ['Mappings', 'Opportunities', 'Conversions'],
    metricKeys: ['mappings', 'opps', 'conversions'],
    color: 'rgba(114,0,203,',
    pendingEvent: 'Activates Week 16 — cross-reference tables building'
  },
  {
    id: 'lifecycle',
    name: 'Equipment Lifecycle',
    desc: 'Installed base tracking by model, age, hours, and repair costs. Fires replacement signals and generates Total Care Bundle offers.',
    metricLabels: ['Units Tracked', 'Signals', 'Conversions'],
    metricKeys: ['units', 'signals', 'conversions'],
    color: 'rgba(255,217,61,',
    pendingEvent: 'Activates Week 24 — installed base mapping begins'
  }
];

// ============================================================
// MONTHLY DATA — scripted for presentation consistency
// Each month: protocol statuses, metric snapshots, events
// ============================================================
const MONTHLY_DATA = [
  // === MONTH 1 (March 2026) — ENGAGE ===
  {
    phase: 'engage',
    protocols: {
      pricing:      { status: 'pending', skus: 0, alerts: 0, bps: 0, rev: 0 },
      reactivation: { status: 'pending', dormant: 0, campaigns: 0, recovered: 0, rev: 0 },
      crossref:     { status: 'pending', mappings: 0, opps: 0, conversions: 0, rev: 0 },
      lifecycle:    { status: 'pending', units: 0, signals: 0, conversions: 0, rev: 0 }
    },
    without: { leak: 915000, churn: 74 },
    events: [
      { cat: 'system', icon: '>', text: 'Charlotte substrate deployed on Firebase — Firestore initialized' },
      { cat: 'system', icon: '>', text: 'NetSuite ERP connected (bi-directional) — 3 years of IAP/IAC transaction history loading' },
      { cat: 'system', icon: '>', text: 'HubSpot CRM synced — 12,400 customer records mapped to knowledge graph' },
      { cat: 'system', icon: '>', text: 'BigCommerce storefront integrated — 2,400 product SKUs cataloged' },
      { cat: 'system', icon: '>', text: '47,000+ historical purchase transactions ingested as SIGNALs' }
    ]
  },
  // === MONTH 2 (April 2026) — DRIVE / Protocol 1 activates ===
  {
    phase: 'drive',
    protocols: {
      pricing:      { status: 'building', skus: 100, alerts: 12, bps: 45, rev: 67500 },
      reactivation: { status: 'pending', dormant: 0, campaigns: 0, recovered: 0, rev: 0 },
      crossref:     { status: 'pending', mappings: 0, opps: 0, conversions: 0, rev: 0 },
      lifecycle:    { status: 'pending', units: 0, signals: 0, conversions: 0, rev: 0 }
    },
    without: { leak: 1830000, churn: 148 },
    events: [
      { cat: 'milestone', icon: '*', text: 'PROTOCOL 1 ACTIVATED — Pricing Intelligence online (Week 8 milestone)' },
      { cat: 'pricing', icon: '$', text: 'Now tracking 100 top SKUs daily across CompressorWorld, CompressorNow, ACS, Amazon' },
      { cat: 'pricing', icon: '!', text: 'ALERT: CompressorWorld lists IR UP6-15 at $12,800 vs ISG $14,000 — price match recommended' },
      { cat: 'pricing', icon: '!', text: 'ALERT: ACS private-label Quincy filter kit at $67 vs ISG OEM $89 — hold: service bundle value exceeds $22 gap' },
      { cat: 'pricing', icon: '$', text: 'Amazon compressed air category up 23% YoY — Charlotte tracking 15 new equipment listings' }
    ]
  },
  // === MONTH 3 (May 2026) — DRIVE ===
  {
    phase: 'drive',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 31, bps: 125, rev: 202500 },
      reactivation: { status: 'pending', dormant: 0, campaigns: 0, recovered: 0, rev: 0 },
      crossref:     { status: 'pending', mappings: 0, opps: 0, conversions: 0, rev: 0 },
      lifecycle:    { status: 'pending', units: 0, signals: 0, conversions: 0, rev: 0 }
    },
    without: { leak: 2745000, churn: 223 },
    events: [
      { cat: 'pricing', icon: '$', text: '47 competitive price observations recorded this month across 4 retailers' },
      { cat: 'pricing', icon: '~', text: 'CompressorNow seasonal promo detected on FS-Curtis filters — pattern logged for Q2 2027 planning' },
      { cat: 'pricing', icon: '!', text: 'Kaishan KRST-20 listed 22% below ISG on CompressorPros — niche brand, low volume: hold pricing' },
      { cat: 'pricing', icon: '+', text: 'Margin improvement: +125 bps on top 25 high-volume parts SKUs' },
      { cat: 'system', icon: '>', text: 'Knowledge graph milestone: 14,200 NODEs, 8,400 EDGEs, 52,000 SIGNALs' }
    ]
  },
  // === MONTH 4 (June 2026) — ENABLE / Protocols 2+3 activate ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 52, bps: 180, rev: 382500 },
      reactivation: { status: 'building', dormant: 2847, campaigns: 342, recovered: 28, rev: 85000 },
      crossref:     { status: 'building', mappings: 187, opps: 34, conversions: 8, rev: 45000 },
      lifecycle:    { status: 'pending', units: 0, signals: 0, conversions: 0, rev: 0 }
    },
    without: { leak: 3660000, churn: 312 },
    events: [
      { cat: 'milestone', icon: '*', text: 'PROTOCOL 2 ACTIVATED — Customer Reactivation Engine online (Week 16)' },
      { cat: 'reactivation', icon: '!', text: '2,847 dormant accounts identified from 3 years of purchase history (>90 days inactive)' },
      { cat: 'reactivation', icon: '+', text: 'Campaign A: 342 "AtRisk" customers (60-90 days) targeted with product affinity offers' },
      { cat: 'milestone', icon: '*', text: 'PROTOCOL 3 ACTIVATED — Product Cross-Reference online' },
      { cat: 'crossref', icon: '+', text: '187 OEM-to-aftermarket part mappings established — ACS private-label counter-strategy loaded' },
      { cat: 'crossref', icon: '$', text: 'Cross-sell: customer purchased IR UP6-25 — Charlotte recommended refrigerated dryer add-on ($3,200)' }
    ]
  },
  // === MONTH 5 (July 2026) ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 71, bps: 200, rev: 607500 },
      reactivation: { status: 'active', dormant: 3120, campaigns: 847, recovered: 79, rev: 260000 },
      crossref:     { status: 'active', mappings: 412, opps: 89, conversions: 24, rev: 155000 },
      lifecycle:    { status: 'pending', units: 0, signals: 0, conversions: 0, rev: 0 }
    },
    without: { leak: 4575000, churn: 398 },
    events: [
      { cat: 'reactivation', icon: '+', text: '52 customers reactivated this month — $127K recovered revenue' },
      { cat: 'reactivation', icon: '!', text: 'Campaign B: 505 "Dormant" tier customers (90-180 days) now targeted' },
      { cat: 'pricing', icon: '!', text: 'CompressorWorld dropped Quincy QGS-25 by $800 — Charlotte recommends hold (service premium justified)' },
      { cat: 'crossref', icon: '~', text: 'ACS private-label separator = IR OEM 39137631 — 35% markup delta identified' },
      { cat: 'crossref', icon: '+', text: '14 cross-sell opportunities generated from installed base purchase patterns' }
    ]
  },
  // === MONTH 6 (August 2026) — FULL PLATFORM / Protocol 4 activates ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 93, bps: 210, rev: 832500 },
      reactivation: { status: 'active', dormant: 3280, campaigns: 1240, recovered: 131, rev: 610000 },
      crossref:     { status: 'active', mappings: 580, opps: 142, conversions: 42, rev: 380000 },
      lifecycle:    { status: 'building', units: 1247, signals: 23, conversions: 3, rev: 120000 }
    },
    without: { leak: 5490000, churn: 481 },
    events: [
      { cat: 'milestone', icon: '*', text: 'PROTOCOL 4 ACTIVATED — Equipment Lifecycle Management online. ALL 4 PROTOCOLS NOW RUNNING.' },
      { cat: 'lifecycle', icon: '+', text: '1,247 installed compressor units mapped from service records across ISG territories' },
      { cat: 'lifecycle', icon: '!', text: 'SIGNAL: 2008 Quincy QT-15 at Columbus food plant — 62K hrs, repair costs 55% of replacement — Total Care Bundle recommended ($349/mo)' },
      { cat: 'lifecycle', icon: '!', text: 'SIGNAL: 2011 IR SS5L5 at Houston auto shop — 15 yrs old, energy efficiency down 22% — upgrade to UP6-15 VSD recommended ($299/mo)' },
      { cat: 'lifecycle', icon: '$', text: 'Food processing customer converted to Total Care Bundle — $41,700 three-year value' }
    ]
  },
  // === MONTH 7 (September 2026) ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 118, bps: 215, rev: 1057500 },
      reactivation: { status: 'active', dormant: 3410, campaigns: 1680, recovered: 186, rev: 960000 },
      crossref:     { status: 'active', mappings: 710, opps: 198, conversions: 61, rev: 605000 },
      lifecycle:    { status: 'active', units: 1580, signals: 52, conversions: 8, rev: 370000 }
    },
    without: { leak: 6405000, churn: 547 },
    events: [
      { cat: 'pricing', icon: '$', text: 'Monthly summary: ISG repriced 23 SKUs, held 14, beat 6 competitor offers this month' },
      { cat: 'reactivation', icon: '$', text: 'Lapsed account (180+ days) in DFW reactivated — new 25HP rotary screw + service agreement ($28,500)' },
      { cat: 'lifecycle', icon: '!', text: 'SIGNAL: 2009 Atlas Copco GA-11 at Tampa medical device facility — maintenance costs accelerating — replacement proposal sent' },
      { cat: 'crossref', icon: '+', text: 'Dryer attachment rate reached 42% on new compressor sales (up from 18% pre-Charlotte)' }
    ]
  },
  // === MONTH 8 (October 2026) ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 144, bps: 235, rev: 1282500 },
      reactivation: { status: 'active', dormant: 3510, campaigns: 2150, recovered: 238, rev: 1310000 },
      crossref:     { status: 'active', mappings: 815, opps: 257, conversions: 79, rev: 830000 },
      lifecycle:    { status: 'active', units: 1820, signals: 89, conversions: 16, rev: 745000 }
    },
    without: { leak: 7320000, churn: 612 },
    events: [
      { cat: 'system', icon: '>', text: 'Knowledge graph: 22,000 NODEs, 15,000 EDGEs, 140,000 SIGNALs — growing daily' },
      { cat: 'lifecycle', icon: '$', text: '3 replacement conversions this month — $125K in Total Care Bundle value' },
      { cat: 'reactivation', icon: '~', text: 'Pattern: HVAC-adjacent facilities reactivate at 2.3x rate vs. manufacturing — weighting campaigns' },
      { cat: 'pricing', icon: '!', text: 'Amazon seller "IndustrialAirDirect" undercutting Champion reciprocating by 15% — Charlotte recommends meeting price' }
    ]
  },
  // === MONTH 9 (November 2026) ===
  {
    phase: 'enable',
    protocols: {
      pricing:      { status: 'active', skus: 100, alerts: 172, bps: 250, rev: 1507500 },
      reactivation: { status: 'active', dormant: 3580, campaigns: 2640, recovered: 287, rev: 1660000 },
      crossref:     { status: 'active', mappings: 890, opps: 320, conversions: 96, rev: 1055000 },
      lifecycle:    { status: 'active', units: 2010, signals: 134, conversions: 27, rev: 1215000 }
    },
    without: { leak: 8235000, churn: 674 },
    events: [
      { cat: 'lifecycle', icon: '$', text: '11 replacement proposals converted this month — $412K total revenue from lifecycle signals' },
      { cat: 'reactivation', icon: '+', text: 'Dormant recovery rate: 18.4% — within 15-20% target range' },
      { cat: 'pricing', icon: '+', text: 'Year-to-date: ISG margins up 250 bps on Charlotte-monitored SKUs' },
      { cat: 'crossref', icon: '>', text: 'Cross-reference database: 890 OEM-to-aftermarket mappings active' }
    ]
  },
  // === MONTH 10 (December 2026) — STABILIZE ===
  {
    phase: 'stabilize',
    protocols: {
      pricing:      { status: 'optimizing', skus: 100, alerts: 198, bps: 260, rev: 1732500 },
      reactivation: { status: 'optimizing', dormant: 3620, campaigns: 3080, recovered: 332, rev: 2010000 },
      crossref:     { status: 'optimizing', mappings: 945, opps: 375, conversions: 112, rev: 1280000 },
      lifecycle:    { status: 'optimizing', units: 2100, signals: 178, conversions: 40, rev: 1685000 }
    },
    without: { leak: 9150000, churn: 731 },
    events: [
      { cat: 'milestone', icon: '*', text: 'Phase transition: STABILIZE — performance optimization and ROI documentation underway' },
      { cat: 'lifecycle', icon: '+', text: 'Installed base expanded to 2,100 units tracked across all 6 ISG states' },
      { cat: 'pricing', icon: '~', text: 'Seasonal pattern: Q4 food processing demand up 12% — ISG held pricing while competitors discounted' },
      { cat: 'reactivation', icon: '$', text: '"Lost" tier campaign (365+ days): 3 long-dormant accounts reactivated — $47K combined' }
    ]
  },
  // === MONTH 11 (January 2027) ===
  {
    phase: 'stabilize',
    protocols: {
      pricing:      { status: 'optimizing', skus: 100, alerts: 222, bps: 265, rev: 1957500 },
      reactivation: { status: 'optimizing', dormant: 3650, campaigns: 3480, recovered: 374, rev: 2360000 },
      crossref:     { status: 'optimizing', mappings: 990, opps: 422, conversions: 127, rev: 1505000 },
      lifecycle:    { status: 'optimizing', units: 2200, signals: 221, conversions: 55, rev: 2155000 }
    },
    without: { leak: 10065000, churn: 789 },
    events: [
      { cat: 'lifecycle', icon: '~', text: 'Year 2 replacement pipeline: 340 units approaching end-of-life in next 18 months' },
      { cat: 'pricing', icon: '+', text: 'Full year intelligence: ISG outperformed competitors on 67% of head-to-head SKU comparisons' },
      { cat: 'reactivation', icon: '+', text: 'Customer retention rate: 91% (vs. 72% pre-Charlotte baseline)' },
      { cat: 'system', icon: '>', text: 'ROI case study documentation in progress for Daved Karl and ISG leadership' }
    ]
  },
  // === MONTH 12 (February 2027) ===
  {
    phase: 'stabilize',
    protocols: {
      pricing:      { status: 'optimizing', skus: 100, alerts: 245, bps: 270, rev: 2182500 },
      reactivation: { status: 'optimizing', dormant: 3680, campaigns: 3840, recovered: 412, rev: 2710000 },
      crossref:     { status: 'optimizing', mappings: 1020, opps: 465, conversions: 141, rev: 1730000 },
      lifecycle:    { status: 'optimizing', units: 2280, signals: 262, conversions: 71, rev: 2625000 }
    },
    without: { leak: 10980000, churn: 847 },
    events: [
      { cat: 'milestone', icon: '*', text: 'YEAR 1 COMPLETE — Charlotte Predictive Distribution fully operational' },
      { cat: 'milestone', icon: '*', text: 'Year 1 total: $9.25M Charlotte-driven revenue on $480K investment — 19.3x ROI' },
      { cat: 'system', icon: '>', text: '412 customers reactivated | 262 replacement signals | 141 cross-sell conversions | +270 bps margin' },
      { cat: 'system', icon: '>', text: 'Pinnacle Industries & ASE expansion scope defined for Year 2' }
    ]
  }
];

// ============================================================
// SIMULATION STATE
// ============================================================
let state = {
  month: 0,
  playing: false,
  speed: 1,
  timer: null,
  events: [],
  revenueHistory: { pricing: [], reactivation: [], crossref: [], lifecycle: [] }
};

// ============================================================
// RENDERING — Protocol Cards
// ============================================================
function buildProtocolCards() {
  const grid = document.getElementById('protocolGrid');
  grid.innerHTML = '';
  PROTOCOLS.forEach(proto => {
    const card = document.createElement('div');
    card.className = 'protocol-card pending';
    card.id = `card-${proto.id}`;
    card.innerHTML = `
      <div class="card-top">
        <h3>${proto.name}</h3>
        <span class="proto-badge pending" id="badge-${proto.id}">PENDING</span>
      </div>
      <div class="card-desc">${proto.desc}</div>
      <div class="card-metrics">
        <div class="card-metric">
          <div class="cm-val" id="cm-${proto.id}-0">—</div>
          <div class="cm-label">${proto.metricLabels[0]}</div>
        </div>
        <div class="card-metric">
          <div class="cm-val" id="cm-${proto.id}-1">—</div>
          <div class="cm-label">${proto.metricLabels[1]}</div>
        </div>
        <div class="card-metric">
          <div class="cm-val" id="cm-${proto.id}-2">—</div>
          <div class="cm-label">${proto.metricLabels[2]}</div>
        </div>
      </div>
      <canvas class="card-chart" id="chart-${proto.id}" height="36"></canvas>
      <div class="card-revenue">
        <span class="cr-label">Revenue Generated</span>
        <span class="cr-val" id="rev-${proto.id}">$0</span>
      </div>
      <div class="card-event" id="evt-${proto.id}">
        <span class="ce-icon">~</span>
        <span>${proto.pendingEvent}</span>
      </div>
    `;
    grid.appendChild(card);
  });
}

function renderProtocolCards() {
  if (state.month === 0) {
    PROTOCOLS.forEach(proto => {
      const card = document.getElementById(`card-${proto.id}`);
      const badge = document.getElementById(`badge-${proto.id}`);
      card.className = 'protocol-card pending';
      badge.className = 'proto-badge pending';
      badge.textContent = 'PENDING';
      proto.metricKeys.forEach((_, i) => {
        document.getElementById(`cm-${proto.id}-${i}`).textContent = '—';
      });
      document.getElementById(`rev-${proto.id}`).textContent = '$0';
      document.getElementById(`evt-${proto.id}`).innerHTML =
        `<span class="ce-icon">~</span><span>${proto.pendingEvent}</span>`;
    });
    return;
  }

  const data = MONTHLY_DATA[state.month - 1];
  const statusLabels = { pending: 'PENDING', building: 'BUILDING', active: 'ACTIVE', optimizing: 'OPTIMIZING' };

  PROTOCOLS.forEach(proto => {
    const pd = data.protocols[proto.id];
    const card = document.getElementById(`card-${proto.id}`);
    const badge = document.getElementById(`badge-${proto.id}`);

    card.className = `protocol-card ${pd.status}`;
    badge.className = `proto-badge ${pd.status}`;
    badge.textContent = statusLabels[pd.status];

    // Metrics
    proto.metricKeys.forEach((key, i) => {
      const el = document.getElementById(`cm-${proto.id}-${i}`);
      const val = pd[key];
      if (pd.status === 'pending') {
        el.textContent = '—';
      } else {
        el.textContent = typeof val === 'number' ? val.toLocaleString() : val;
      }
    });

    // Revenue
    const revEl = document.getElementById(`rev-${proto.id}`);
    revEl.textContent = pd.rev > 0 ? '$' + pd.rev.toLocaleString() : '$0';

    // Latest event for this protocol
    const protoEvents = data.events.filter(e => e.cat === proto.id || (e.cat === 'milestone' && e.text.includes(`PROTOCOL ${PROTOCOLS.indexOf(proto) + 1}`)));
    const evtEl = document.getElementById(`evt-${proto.id}`);
    if (protoEvents.length > 0) {
      const latest = protoEvents[protoEvents.length - 1];
      evtEl.innerHTML = `<span class="ce-icon">${latest.icon}</span><span>${latest.text}</span>`;
    } else if (pd.status === 'pending') {
      evtEl.innerHTML = `<span class="ce-icon">~</span><span>${proto.pendingEvent}</span>`;
    }

    // Sparkline chart
    drawProtoChart(proto.id);
  });
}

function drawProtoChart(protoId) {
  const canvas = document.getElementById(`chart-${protoId}`);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;

  canvas.width = canvas.offsetWidth * dpr;
  canvas.height = canvas.offsetHeight * dpr;
  ctx.scale(dpr, dpr);

  const w = canvas.offsetWidth;
  const h = canvas.offsetHeight;
  const history = state.revenueHistory[protoId];

  ctx.clearRect(0, 0, w, h);

  if (history.length < 1) return;

  // Find final max for consistent scale
  const finalData = MONTHLY_DATA[MONTHLY_DATA.length - 1].protocols[protoId];
  const maxVal = Math.max(finalData.rev * 1.05, 1);

  const stepX = w / (TOTAL_MONTHS - 1);

  // Area fill
  ctx.beginPath();
  ctx.moveTo(0, h);
  history.forEach((v, i) => {
    const x = i * stepX;
    const y = h - (v / maxVal) * (h - 4);
    if (i === 0) ctx.lineTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.lineTo((history.length - 1) * stepX, h);
  ctx.closePath();

  const proto = PROTOCOLS.find(p => p.id === protoId);
  ctx.fillStyle = proto.color + '0.08)';
  ctx.fill();

  // Line
  ctx.beginPath();
  history.forEach((v, i) => {
    const x = i * stepX;
    const y = h - (v / maxVal) * (h - 4);
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.strokeStyle = proto.color + '0.7)';
  ctx.lineWidth = 2;
  ctx.stroke();

  // End dot
  if (history.length > 0) {
    const lastX = (history.length - 1) * stepX;
    const lastY = h - (history[history.length - 1] / maxVal) * (h - 4);
    ctx.beginPath();
    ctx.arc(lastX, lastY, 3, 0, Math.PI * 2);
    ctx.fillStyle = proto.color + '0.9)';
    ctx.fill();
  }
}

// ============================================================
// RENDERING — Financial Metrics
// ============================================================
function renderMetrics() {
  if (state.month === 0) {
    document.getElementById('m-protocols').textContent = '0 / 4';
    document.getElementById('m-rev').textContent = '$0';
    document.getElementById('m-recovered').textContent = '0';
    document.getElementById('m-leak').textContent = '$0';
    document.getElementById('m-churn').textContent = '0';
    document.getElementById('m-blind').textContent = '100+ SKUs';
    document.getElementById('m-total').textContent = '$0';
    document.getElementById('m-roi').textContent = 'Year 1 ROI on $480K investment';
    return;
  }

  const data = MONTHLY_DATA[state.month - 1];
  const protos = data.protocols;

  // Count active protocols
  let activeCount = 0;
  Object.values(protos).forEach(p => {
    if (p.status !== 'pending') activeCount++;
  });

  // Total revenue
  const totalRev = protos.pricing.rev + protos.reactivation.rev + protos.crossref.rev + protos.lifecycle.rev;
  const recovered = protos.reactivation.recovered;

  document.getElementById('m-protocols').textContent = activeCount + ' / 4';
  document.getElementById('m-rev').textContent = '$' + totalRev.toLocaleString();
  document.getElementById('m-recovered').textContent = recovered.toLocaleString();

  // Without Charlotte
  document.getElementById('m-leak').textContent = '$' + data.without.leak.toLocaleString();
  document.getElementById('m-churn').textContent = data.without.churn.toLocaleString();

  const blindText = protos.pricing.status === 'pending' ? '100+ SKUs' : '0 SKUs';
  document.getElementById('m-blind').textContent = blindText;

  // Net uplift
  document.getElementById('m-total').textContent = '$' + totalRev.toLocaleString();
  if (totalRev > 0) {
    const roi = (totalRev / 480000).toFixed(1);
    document.getElementById('m-roi').textContent = roi + 'x ROI on $480K investment';
  } else {
    document.getElementById('m-roi').textContent = 'Year 1 ROI on $480K investment';
  }
}

// ============================================================
// RENDERING — Phase Bar
// ============================================================
function renderPhaseBar() {
  const currentPhase = state.month === 0 ? null : MONTHLY_DATA[state.month - 1].phase;

  const phaseOrder = ['engage', 'drive', 'enable', 'stabilize'];
  const currentIdx = currentPhase ? phaseOrder.indexOf(currentPhase) : -1;

  phaseOrder.forEach((pid, i) => {
    const el = document.getElementById(`phase-${pid}`);
    el.className = 'phase-step';
    if (i < currentIdx) el.classList.add('completed');
    else if (i === currentIdx) el.classList.add('active');

    // Update connector fills
    if (i < 3) {
      const conn = document.getElementById(`pconn-${i + 1}`);
      if (i < currentIdx) conn.style.width = '100%';
      else if (i === currentIdx) conn.style.width = '50%';
      else conn.style.width = '0%';
    }
  });

  // Update checkmarks for completed phases
  phaseOrder.forEach((pid, i) => {
    const numEl = document.querySelector(`#phase-${pid} .phase-num`);
    if (i < currentIdx) {
      numEl.textContent = '\u2713';
    } else {
      numEl.textContent = (i + 1).toString();
    }
  });
}

// ============================================================
// RENDERING — Events
// ============================================================
function renderEvents() {
  const list = document.getElementById('eventList');
  list.innerHTML = '';

  const iconMap = {
    '>': '\u25B8', '$': '\u25C6', '!': '\u25B2', '+': '\u2605',
    '~': '\u25CB', '*': '\u2726'
  };

  state.events.slice(0, 40).forEach(ev => {
    const item = document.createElement('div');
    item.className = `event-item ${ev.cat}`;
    item.innerHTML = `
      <span class="event-icon">${iconMap[ev.icon] || '\u25CB'}</span>
      <span class="event-text">${ev.text}</span>
      <span class="event-time">${ev.monthLabel}</span>
    `;
    list.appendChild(item);
  });
}

// ============================================================
// RENDERING — Time Controls
// ============================================================
function renderTimeControls() {
  const pct = (state.month / TOTAL_MONTHS) * 100;
  document.getElementById('progressFill').style.width = pct + '%';

  const playBtn = document.getElementById('playBtn');
  playBtn.innerHTML = state.playing ? '&#9646;&#9646;' : '&#9654;';
  playBtn.className = state.playing ? 'btn play-btn playing' : 'btn play-btn';

  const display = document.getElementById('timeDisplay');
  if (state.month === 0) {
    display.innerHTML = 'Month <strong>0</strong> of 12 &mdash; <span class="phase-label">Ready</span>';
  } else {
    const data = MONTHLY_DATA[state.month - 1];
    const phaseLabel = data.phase.charAt(0).toUpperCase() + data.phase.slice(1);
    display.innerHTML = `Month <strong>${state.month}</strong> of 12 &mdash; <span class="phase-label">${MONTHS[state.month - 1]} 2026 &middot; ${phaseLabel}</span>`;
    // Fix Jan/Feb to 2027
    if (state.month >= 11) {
      display.innerHTML = `Month <strong>${state.month}</strong> of 12 &mdash; <span class="phase-label">${MONTHS[state.month - 1]} 2027 &middot; ${phaseLabel}</span>`;
    }
  }
}

// ============================================================
// SIMULATION ENGINE
// ============================================================
function tick() {
  if (state.month >= TOTAL_MONTHS) {
    pause();
    return;
  }

  state.month++;
  const data = MONTHLY_DATA[state.month - 1];

  // Record revenue history for sparklines
  PROTOCOLS.forEach(proto => {
    state.revenueHistory[proto.id].push(data.protocols[proto.id].rev);
  });

  // Add events to feed (newest first)
  const monthEvents = data.events.map(e => ({
    ...e,
    monthLabel: MONTHS[state.month - 1]
  }));
  // Reverse so newest appear at top
  monthEvents.reverse().forEach(e => state.events.unshift(e));

  // Render everything
  renderProtocolCards();
  renderMetrics();
  renderPhaseBar();
  renderTimeControls();
  renderEvents();
}

function play() {
  if (state.month >= TOTAL_MONTHS) return;
  state.playing = true;
  renderTimeControls();
  state.timer = setInterval(tick, TICK_MS / state.speed);
}

function pause() {
  state.playing = false;
  clearInterval(state.timer);
  state.timer = null;
  renderTimeControls();
}

function togglePlay() {
  if (state.playing) pause(); else play();
}

function setSpeed(speed, btn) {
  state.speed = speed;
  document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (state.playing) {
    clearInterval(state.timer);
    state.timer = setInterval(tick, TICK_MS / state.speed);
  }
}

function seekTo(e) {
  const track = document.getElementById('progressTrack');
  const rect = track.getBoundingClientRect();
  const pct = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  const targetMonth = Math.round(pct * TOTAL_MONTHS);

  const wasPlaying = state.playing;
  if (wasPlaying) pause();

  // Reset and replay to target
  resetState();
  for (let i = 0; i < targetMonth; i++) {
    state.month++;
    const data = MONTHLY_DATA[state.month - 1];
    PROTOCOLS.forEach(proto => {
      state.revenueHistory[proto.id].push(data.protocols[proto.id].rev);
    });
    const monthEvents = data.events.map(ev => ({ ...ev, monthLabel: MONTHS[state.month - 1] }));
    monthEvents.reverse().forEach(ev => state.events.unshift(ev));
  }

  renderProtocolCards();
  renderMetrics();
  renderPhaseBar();
  renderTimeControls();
  renderEvents();

  if (wasPlaying && state.month < TOTAL_MONTHS) play();
}

function resetState() {
  state.month = 0;
  state.events = [];
  state.revenueHistory = { pricing: [], reactivation: [], crossref: [], lifecycle: [] };
}

function resetSimulation() {
  pause();
  resetState();
  renderProtocolCards();
  renderMetrics();
  renderPhaseBar();
  renderTimeControls();
  renderEvents();
}

// ============================================================
// INTRO & INIT
// ============================================================
function startSimulation() {
  document.getElementById('introOverlay').classList.add('hidden');
  setTimeout(() => play(), 600);
}

function init() {
  buildProtocolCards();
  renderProtocolCards();
  renderMetrics();
  renderPhaseBar();
  renderTimeControls();

  window.addEventListener('resize', () => {
    PROTOCOLS.forEach(proto => drawProtoChart(proto.id));
  });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
